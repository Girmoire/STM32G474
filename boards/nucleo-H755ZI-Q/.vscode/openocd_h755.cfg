# OpenOCD configuration for STM32H755ZI-Q Nucleo board

# Check for ST-Link command line options
if { [info exists USE_STLINK_V3] } {
    source [find interface/stlink-v3.cfg]
} else {
    source [find interface/stlink.cfg]
}

# Configure the transport
if { [adapter name] ne "hla" } {
    transport select swd
} else {
    # For single core debugging with HLA
    transport select hla_swd
}

# Target configuration
set CHIPNAME stm32h755ziq
set ENABLE_LOW_POWER 0
set STOP_WATCHDOG 1

# Dual core setup
set DUAL_CORE 1
set DUAL_BANK 1

# Work area
set WORKAREASIZE 0x10000

# Load the target configuration
source [find target/stm32h7x.cfg]

# Configure GDB ports for dual core
if { [info exists DUAL_CORE] && $DUAL_CORE } {
    ${CHIPNAME}.cpu0 configure -gdb-port 50001
    ${CHIPNAME}.cpu1 configure -gdb-port 50002
}

# Reset configuration
reset_config srst_only srst_nogate

# Adapter speed
adapter speed 4000